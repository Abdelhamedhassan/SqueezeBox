{% extends 'base.html' %}

{% block content %}
<div class="container">
  <h1>Image Compression üñºÔ∏è</h1>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  {% for category, message in messages %}
  <div
    class="alert alert-{{ category }} alert-dismissible fade show"
    role="alert"
  >
    {{ message }}
    <button type="button" class="close" data-dismiss="alert">
      <span>&times;</span>
    </button>
  </div>
  {% endfor %}
  {% endif %}
  {% endwith %}

  <form method="post" enctype="multipart/form-data">
    {{ form.hidden_tag() }}

    <div class="form-group">
      {{ form.image_file.label }}
      <label for="image_file" class="custom-file-label up">
        <i class="fas fa-upload"></i> Upload File
      </label>
      {{ form.image_file(class="form-control-file d-none test", id="image_file") }}
      {% if form.image_file.errors %}
      {% for error in form.image_file.errors %}
      <span class="text-danger">{{ error }}</span>
      {% endfor %}
      {% endif %}
      <small class="form-text text-muted">
        Supported formats: JPG, JPEG, PNG (max 10MB)
      </small>
    </div>

    <div class="form-group">
      {{ form.quality.label }}
      {{ form.quality(class="form-control", min="10", max="100", step="1") }}
      {% if form.quality.errors %}
      {% for error in form.quality.errors %}
      <span class="text-danger">{{ error }}</span>
      {% endfor %}
      {% endif %}
      <small class="form-text text-muted">
        Compression quality: 10 (low) to 100 (high)
      </small>
    </div>

    {{ form.submit(class="btn btn-primary") }}
  </form>
</div>

<script>
  document.getElementById("image_file").addEventListener("change", function () {
    const label = document.querySelector(".custom-file-label");
    const fileName = this.files[0] ? this.files[0].name : "Upload File";
    label.innerHTML = `<i class="fas fa-upload"></i> ${fileName}`;
  });
</script>
{% endblock %}
